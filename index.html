<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramazon 2026 - Rasmiy Taqvim</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root {
            --bg: #020617;
            --card: #0f172a;
            --primary: #10b981;
            --accent: #fbbf24;
            --white: #f8fafc;
        }
        body {
            background-color: var(--bg);
            color: var(--white);
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0; padding: 10px;
            display: flex; flex-direction: column; align-items: center;
        }
        .app-container { width: 100%; max-width: 450px; }
        
        /* Header Dizayni */
        .header {
            text-align: center; padding: 30px 10px;
            background: linear-gradient(to bottom, rgba(16,185,129,0.1), transparent);
            border-radius: 30px; margin-bottom: 20px;
        }
        .header h1 { font-size: 26px; margin: 10px 0; color: var(--accent); letter-spacing: 1px; }

        /* Viloyat tanlash va Tugma */
        .settings-card {
            background: var(--card);
            padding: 20px; border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        select {
            width: 100%; padding: 15px; border-radius: 12px;
            background: #1e293b; color: white; border: 1px solid var(--primary);
            font-size: 16px; margin-bottom: 15px; outline: none;
        }
        .btn-notify {
            width: 100%; padding: 18px; border-radius: 15px; border: none;
            background: linear-gradient(135deg, var(--primary), #059669);
            color: white; font-weight: 800; font-size: 15px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            cursor: pointer; box-shadow: 0 4px 15px rgba(16,185,129,0.4);
        }

        /* Yo'riqnoma */
        #guide {
            display: none; background: rgba(251,191,36,0.1);
            border: 1px dashed var(--accent); padding: 15px;
            border-radius: 15px; margin-top: 15px; font-size: 13px; line-height: 1.5;
        }

        /* Taqvim Ro'yxati */
        .day-card {
            background: var(--card); margin-bottom: 10px; padding: 15px 20px;
            border-radius: 18px; display: flex; justify-content: space-between;
            align-items: center; border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s;
        }
        .day-card:hover { border-color: var(--primary); transform: scale(1.02); }
        .day-info { display: flex; flex-direction: column; }
        .day-num { color: var(--primary); font-weight: 900; font-size: 20px; }
        .day-date { color: #64748b; font-size: 12px; }
        
        .time-info { text-align: right; }
        .time-row { display: flex; gap: 15px; align-items: center; }
        .t-box { display: flex; flex-direction: column; }
        .t-label { font-size: 10px; color: #94a3b8; text-transform: uppercase; }
        .t-val { font-weight: 700; font-size: 16px; }
        .sahr { color: var(--white); }
        .ift { color: var(--accent); }

        .ios-info { color: #94a3b8; font-size: 11px; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="header animate__animated animate__fadeInDown">
            <i data-lucide="moon-star" style="color:var(--accent); width:45px; height:45px;"></i>
            <h1>RAMAZON 2026</h1>
            <p style="color:#94a3b8;">1447-Hijriy yil taqvimi</p>
        </div>

        <div class="settings-card animate__animated animate__fadeIn">
            <label style="font-size: 12px; color: var(--primary); margin-bottom: 8px; display: block;">HUDUDNI TANLANG:</label>
            <select id="regionSelect" onchange="renderCalendar()">
                <option value="Toshkent">Toshkent</option>
                <option value="Andijon">Andijon (-10 min)</option>
                <option value="Buxoro">Buxoro (+21 min)</option>
                <option value="Samarqand">Samarqand (+9 min)</option>
                <option value="Xorazm">Xorazm (+35 min)</option>
                <option value="Nukus">Nukus (+38 min)</option>
                <option value="Namangan">Namangan (-8 min)</option>
                <option value="Farg'ona">Farg'ona (-9 min)</option>
                <option value="Jizzax">Jizzax (+6 min)</option>
                <option value="Navoiy">Navoiy (+15 min)</option>
                <option value="Qashqadaryo">Qashqadaryo (+15 min)</option>
                <option value="Surxondaryo">Surxondaryo (+10 min)</option>
            </select>

            <button class="btn-notify" onclick="showGuide()">
                <i data-lucide="bell-ring"></i> Bildirishnomalarni yoqish
            </button>

            <div id="guide" class="animate__animated animate__pulse">
                <p><strong>Xavfsiz va Ishonchli:</strong></p>
                1. "Taqvimga saqlash" tugmasini bosing.<br>
                2. Yuklangan faylni ochib, <b>"Add All"</b> (Barchasini qo'shish) ni tanlang.<br>
                3. Telefoningiz 10 daqiqa qolganda sizni budilnik kabi ogohlantiradi.<br>
                <button class="btn-notify" style="margin-top:15px; background:var(--accent); color:#000;" onclick="downloadICS()">
                    Taqvimga saqlash (.ics)
                </button>
            </div>
            <p class="ios-info">iOS va Android tizimlarida 100% xavfsiz ishlaydi</p>
        </div>

        <div id="calendarList"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.backgroundColor = "#020617";

        const offsets = { "Toshkent":0, "Andijon":-10, "Buxoro":21, "Samarqand":9, "Xorazm":35, "Nukus":38, "Namangan":-8, "Farg'ona":-9, "Jizzax":6, "Navoiy":15, "Qashqadaryo":15, "Surxondaryo":10 };

        // 2026-yil 19-fevraldan boshlab 30 kunlik Toshkent vaqtlari (Fatvo.uz asosida)
        const ramadanTimes = [
            {s:"05:35", i:"18:05"}, {s:"05:34", i:"18:06"}, {s:"05:33", i:"18:07"}, {s:"05:31", i:"18:08"}, {s:"05:30", i:"18:10"},
            {s:"05:28", i:"18:11"}, {s:"05:27", i:"18:12"}, {s:"05:25", i:"18:13"}, {s:"05:24", i:"18:14"}, {s:"05:22", i:"18:15"},
            {s:"05:21", i:"18:17"}, {s:"05:19", i:"18:18"}, {s:"05:18", i:"18:19"}, {s:"05:16", i:"18:20"}, {s:"05:14", i:"18:21"},
            {s:"05:13", i:"18:22"}, {s:"05:11", i:"18:23"}, {s:"05:09", i:"18:25"}, {s:"05:08", i:"18:26"}, {s:"05:06", i:"18:27"},
            {s:"05:04", i:"18:28"}, {s:"05:03", i:"18:29"}, {s:"05:01", i:"18:30"}, {s:"04:59", i:"18:31"}, {s:"04:58", i:"18:32"},
            {s:"04:56", i:"18:33"}, {s:"04:54", i:"18:35"}, {s:"04:53", i:"18:36"}, {s:"04:51", i:"18:37"}, {s:"04:49", i:"18:38"}
        ];

        function calc(t, m) {
            let [h, min] = t.split(':').map(Number);
            let d = new Date(); d.setHours(h, min + m);
            return d.toTimeString().slice(0, 5);
        }

        function renderCalendar() {
            const reg = document.getElementById('regionSelect').value;
            const off = offsets[reg];
            const list = document.getElementById('calendarList');
            list.innerHTML = '';

            ramadanTimes.forEach((v, i) => {
                const day = i + 1;
                const dateText = (i + 19) > 28 ? (i + 19 - 28) + "-mart" : (i + 19) + "-fevral";
                list.innerHTML += `
                    <div class="day-card animate__animated animate__fadeInUp" style="animation-delay: ${i*0.03}s">
                        <div class="day-info">
                            <span class="day-num">${day}</span>
                            <span class="day-date">${dateText}</span>
                        </div>
                        <div class="time-info">
                            <div class="time-row">
                                <div class="t-box">
                                    <span class="t-label">Saharlik</span>
                                    <span class="t-val sahr">${calc(v.s, off)}</span>
                                </div>
                                <div class="t-box">
                                    <span class="t-label">Iftorlik</span>
                                    <span class="t-val ift">${calc(v.i, off)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            lucide.createIcons();
        }

        function showGuide() { document.getElementById('guide').style.display = 'block'; }

        function downloadICS() {
            const reg = document.getElementById('regionSelect').value;
            const off = offsets[reg];
            let ics = "BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//RamazonTaqvim//UZ\n";

            ramadanTimes.forEach((v, i) => {
                const dayNum = i + 19;
                const m = dayNum > 28 ? "03" : "02";
                const d = dayNum > 28 ? String(dayNum - 28).padStart(2, '0') : String(dayNum).padStart(2, '0');
                const date = `2026${m}${d}`;
                
                const sT = calc(v.s, off).replace(':','');
                const iT = calc(v.i, off).replace(':','');

                // Saharlik uchun: 10 min oldin bildirishnoma
                ics += `BEGIN:VEVENT\nSUMMARY:Saharlik (${reg})\nDTSTART:${date}T${sT}00\nDESCRIPTION:10 daqiqadan so'ng saharlik tugaydi! Hozir vaqt: ${calc(v.s, off)}\nBEGIN:VALARM\nTRIGGER:-PT10M\nACTION:DISPLAY\nDESCRIPTION:Saharlik tugashiga 10 daqiqa qoldi! (${calc(v.s, off)}da yopiladi)\nEND:VALARM\nEND:VEVENT\n`;
                
                // Iftorlik uchun: 10 min oldin bildirishnoma
                ics += `BEGIN:VEVENT\nSUMMARY:Iftorlik (${reg})\nDTSTART:${date}T${iT}00\nDESCRIPTION:Iftorlik vaqti bo'ldi: ${calc(v.i, off)}\nBEGIN:VALARM\nTRIGGER:-PT10M\nACTION:DISPLAY\nDESCRIPTION:Iftorlikka 10 daqiqa qoldi! (${calc(v.i, off)}da ochiladi)\nEND:VALARM\nEND:VEVENT\n`;
            });

            ics += "END:VCALENDAR";
            const blob = new Blob([ics], {type: 'text/calendar'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Ramazon_2026_${reg}.ics`;
            link.click();
            tg.showConfirm("Taqvim fayli yuklandi. Uni ochib 'Barchasini qo'shish' tugmasini bosishni unutmang!");
        }

        renderCalendar();
    </script>
</body>
</html>
